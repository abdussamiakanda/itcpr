<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <title>Financial Transparency - ITCPR</title>
    <meta charset="utf-8" />
    <meta name="visibility" content="visible" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta property="og:title" content="Financial Transparency - ITCPR" />
    <meta
      property="og:description"
      content="Learn about ITCPR's financial management, funding sources, and how we ensure responsible use of resources to advance our research mission." />
    <meta property="og:image" content="/assets/image/logo.png" />
    <link rel="shortcut icon" href="/assets/image/short.png" />
    <script
      src="https://kit.fontawesome.com/a1b0511c5a.js"
      crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet" />
    <link rel="stylesheet" href="/assets/css/root.css" />
    <link rel="stylesheet" href="/assets/css/header.css" />
    <link rel="stylesheet" href="/assets/css/footer.css" />
    <link rel="stylesheet" href="/assets/css/financials.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <section id="header"></section>

    <main>
      <!-- Page Header -->
      <section class="page-header">
        <div class="container">
          <div class="page-header-content">
            <h1>Financial Transparency</h1>
            <p>Explore ITCPR's financial management, funding sources, and our commitment to responsible use of resources to advance our research mission.</p>
          </div>
        </div>
      </section>

      <!-- Year Selector -->
      <section class="content-section">
        <div class="contained">
          <div class="year-selector" id="yearSelector">
            <!-- Years will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- Financial Overview -->
      <section class="content-section">
        <div class="contained">
          <div class="financial-overview">
            <h2 id="yearTitle">2023 Financial Overview</h2>
            <div class="budget-summary" id="budgetSummary">
              <!-- Budget cards will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </section>

      <!-- Expenditures Section -->
      <section class="content-section expenditure-section">
        <div class="contained">
          <h2>Research Expenditures</h2>
          <div class="expenditure-grid" id="researchExpenditures">
            <!-- Research expenditure cards will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- Operational Costs Section -->
      <section class="content-section expenditure-section">
        <div class="contained">
          <h2>Operational Costs</h2>
          <div class="expenditure-grid" id="operationalCosts">
            <!-- Operational costs cards will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- Capacity Building Section -->
      <section class="content-section expenditure-section">
        <div class="contained">
          <h2>Capacity Building</h2>
          <div class="expenditure-grid" id="capacityBuilding">
            <!-- Capacity building cards will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- Administrative Expenses Section -->
      <section class="content-section expenditure-section">
        <div class="contained">
          <h2>Administrative Expenses</h2>
          <div class="expenditure-grid" id="administrativeExpenses">
            <!-- Administrative expenses cards will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- Funding Sources Section -->
      <section class="content-section funding-sources">
        <div class="contained">
          <h2>Funding Sources</h2>
          <div class="funding-chart">
            <canvas id="fundingChart"></canvas>
          </div>
          <div class="expenditure-grid" id="fundingSources">
            <!-- Funding source cards will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- Key Metrics Section -->
      <section class="content-section">
        <div class="contained">
          <div class="metrics-grid" id="keyMetrics">
            <!-- Metric cards will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- Financial Controls Section -->
      <section class="content-section controls-section">
        <div class="contained">
          <h2>Financial Controls and Oversight</h2>
          <div class="controls-list" id="financialControls">
            <!-- Control items will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- Last Updated -->
      <section class="content-section">
        <div class="contained">
          <div class="last-updated" id="lastUpdated">
            Last Updated: February 15, 2024
          </div>
        </div>
      </section>
    </main>

    <section id="footer"></section>

    <script src="/assets/js/header.js"></script>
    <script src="/assets/js/footer.js"></script>
    <script>
      // Format currency
      const formatCurrency = (amount) => {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        }).format(amount);
      };

      // Format percentage
      const formatPercentage = (value) => {
        return `${value}%`;
      };

      // Create budget card
      const createBudgetCard = (title, amount, percentage) => {
        return `
          <div class="budget-card">
            <h3>${title}</h3>
            <div class="budget-amount">${formatCurrency(amount)}</div>
            <div class="budget-percentage">${formatPercentage(percentage)}</div>
          </div>
        `;
      };

      // Create expenditure card
      const createExpenditureCard = (title, amount, items) => {
        return `
          <div class="expenditure-card">
            <h3>${title}</h3>
            <div class="budget-amount">${formatCurrency(amount)}</div>
            <ul class="expenditure-list">
              ${items.map(item => `<li>${item}</li>`).join('')}
            </ul>
          </div>
        `;
      };

      // Create metric card
      const createMetricCard = (label, value) => {
        return `
          <div class="metric-card">
            <div class="metric-value">${value}</div>
            <div class="metric-label">${label}</div>
          </div>
        `;
      };

      // Create control item
      const createControlItem = (title, description) => {
        return `
          <div class="control-item">
            <h4>${title}</h4>
            <p>${description}</p>
          </div>
        `;
      };

      // Update funding chart
      let fundingChartInstance = null;
      const updateFundingChart = (fundingData) => {
        const ctx = document.getElementById('fundingChart').getContext('2d');
        
        // Destroy existing chart if it exists
        if (fundingChartInstance) {
          fundingChartInstance.destroy();
        }

        // Create new chart
        fundingChartInstance = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: Object.keys(fundingData).map(key => 
              key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')
            ),
            datasets: [{
              data: Object.values(fundingData).map(source => source.total),
              backgroundColor: [
                '#1a73e8',
                '#34a853',
                '#fbbc05',
                '#ea4335'
              ]
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }
        });
      };

      // Load and display financial data
      const loadFinancialData = async (year) => {
        try {
          const response = await fetch('/data/finance.json');
          const data = await response.json();
          const yearData = data.years[year];

          if (!yearData) {
            console.error(`No data available for year ${year}`);
            return;
          }

          // Update year selector
          document.getElementById('yearTitle').textContent = `${year} Financial Overview`;

          // Update budget summary
          document.getElementById('budgetSummary').innerHTML = `
            ${createBudgetCard('Total Budget', yearData.total_budget, 100)}
            ${createBudgetCard('Funds Collected', Object.values(yearData.funding_sources).reduce((sum, source) => sum + source.total, 0), 
              (Object.values(yearData.funding_sources).reduce((sum, source) => sum + source.total, 0) / yearData.total_budget * 100).toFixed(1))}
            ${createBudgetCard('Total Expenses', 
              yearData.research_expenditures.categories.research_traveling.amount + 
              yearData.research_expenditures.categories.publication.amount +
              yearData.operational_costs.categories.facility_maintenance.amount + 
              yearData.operational_costs.categories.server_maintenance.amount +
              yearData.educational_initiatives.categories.educational_programs.amount + 
              yearData.educational_initiatives.categories.student_support.amount +
              yearData['outreach_&amp;_communication'].categories.community_engagement.amount + 
              yearData['outreach_&amp;_communication'].categories.promotional_activity.amount,
              ((yearData.research_expenditures.categories.research_traveling.amount + 
                yearData.research_expenditures.categories.publication.amount +
                yearData.operational_costs.categories.facility_maintenance.amount + 
                yearData.operational_costs.categories.server_maintenance.amount +
                yearData.educational_initiatives.categories.educational_programs.amount + 
                yearData.educational_initiatives.categories.student_support.amount +
                yearData['outreach_&amp;_communication'].categories.community_engagement.amount + 
                yearData['outreach_&amp;_communication'].categories.promotional_activity.amount) / yearData.total_budget * 100).toFixed(1))}
            ${createBudgetCard('Leftover/Deficit', 
              Object.values(yearData.funding_sources).reduce((sum, source) => sum + source.total, 0) - 
              (yearData.research_expenditures.categories.research_traveling.amount + 
              yearData.research_expenditures.categories.publication.amount +
              yearData.operational_costs.categories.facility_maintenance.amount + 
              yearData.operational_costs.categories.server_maintenance.amount +
              yearData.educational_initiatives.categories.educational_programs.amount + 
              yearData.educational_initiatives.categories.student_support.amount +
              yearData['outreach_&amp;_communication'].categories.community_engagement.amount + 
              yearData['outreach_&amp;_communication'].categories.promotional_activity.amount),
              ((Object.values(yearData.funding_sources).reduce((sum, source) => sum + source.total, 0) - 
              (yearData.research_expenditures.categories.research_traveling.amount + 
              yearData.research_expenditures.categories.publication.amount +
              yearData.operational_costs.categories.facility_maintenance.amount + 
              yearData.operational_costs.categories.server_maintenance.amount +
              yearData.educational_initiatives.categories.educational_programs.amount + 
              yearData.educational_initiatives.categories.student_support.amount +
              yearData['outreach_&amp;_communication'].categories.community_engagement.amount + 
              yearData['outreach_&amp;_communication'].categories.promotional_activity.amount)) / yearData.total_budget * 100).toFixed(1))}
            ${createBudgetCard('Research', yearData.research_expenditures.categories.research_traveling.amount + 
              yearData.research_expenditures.categories.publication.amount, 
              ((yearData.research_expenditures.categories.research_traveling.amount + 
                yearData.research_expenditures.categories.publication.amount) / yearData.total_budget * 100).toFixed(1))}
            ${createBudgetCard('Operations', yearData.operational_costs.categories.facility_maintenance.amount + 
              yearData.operational_costs.categories.server_maintenance.amount,
              ((yearData.operational_costs.categories.facility_maintenance.amount + 
                yearData.operational_costs.categories.server_maintenance.amount) / yearData.total_budget * 100).toFixed(1))}
            ${createBudgetCard('Educational Initiatives', yearData.educational_initiatives.categories.educational_programs.amount + 
              yearData.educational_initiatives.categories.student_support.amount,
              ((yearData.educational_initiatives.categories.educational_programs.amount + 
                yearData.educational_initiatives.categories.student_support.amount) / yearData.total_budget * 100).toFixed(1))}
            ${createBudgetCard('Outreach & Communication', yearData['outreach_&amp;_communication'].categories.community_engagement.amount + 
              yearData['outreach_&amp;_communication'].categories.promotional_activity.amount,
              ((yearData['outreach_&amp;_communication'].categories.community_engagement.amount + 
                yearData['outreach_&amp;_communication'].categories.promotional_activity.amount) / yearData.total_budget * 100).toFixed(1))}
          `;

          // Update research expenditures
          document.getElementById('researchExpenditures').innerHTML = Object.entries(yearData.research_expenditures.categories)
            .map(([key, value]) => createExpenditureCard(
              key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
              value.amount,
              value.items
            )).join('');

          // Update operational costs
          document.getElementById('operationalCosts').innerHTML = Object.entries(yearData.operational_costs.categories)
            .map(([key, value]) => createExpenditureCard(
              key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
              value.amount,
              value.items
            )).join('');

          // Update educational initiatives
          document.getElementById('capacityBuilding').innerHTML = Object.entries(yearData.educational_initiatives.categories)
            .map(([key, value]) => createExpenditureCard(
              key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
              value.amount,
              value.items
            )).join('');

          // Update outreach & communication
          document.getElementById('administrativeExpenses').innerHTML = Object.entries(yearData['outreach_&amp;_communication'].categories)
            .map(([key, value]) => createExpenditureCard(
              key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
              value.amount,
              value.items
            )).join('');

          // Update funding sources
          document.getElementById('fundingSources').innerHTML = Object.entries(yearData.funding_sources)
            .map(([key, value]) => createExpenditureCard(
              key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
              value.total,
              [`Total: ${formatCurrency(value.total)}`]
            )).join('');

          // Update funding chart
          updateFundingChart(yearData.funding_sources);

          // Update key metrics
          document.getElementById('keyMetrics').innerHTML = Object.entries(yearData.key_metrics)
            .map(([key, value]) => createMetricCard(
              key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
              value
            )).join('');

          // Update financial controls
          document.getElementById('financialControls').innerHTML = Object.entries(yearData.financial_controls)
            .map(([key, value]) => createControlItem(
              key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '),
              value
            )).join('');

          // Update last updated date
          document.getElementById('lastUpdated').textContent = `Last Updated: ${new Date(data.last_updated).toLocaleDateString()}`;

        } catch (error) {
          console.error('Error loading financial data:', error);
        }
      };

      // Initialize year selector
      const initializeYearSelector = async () => {
        try {
          const response = await fetch('/data/finance.json');
          const data = await response.json();
          const years = Object.keys(data.years).sort((a, b) => b - a); // Sort years in descending order

          if (years.length === 0) {
            console.error('No years available in the data');
            return;
          }

          document.getElementById('yearSelector').innerHTML = years
            .map(year => `
              <button class="year-button ${year === years[0] ? 'active' : ''}" 
                      onclick="loadFinancialData('${year}'); this.classList.add('active'); 
                              this.parentElement.querySelectorAll('.year-button').forEach(btn => 
                                btn !== this && btn.classList.remove('active')
                              )">
                ${year}
              </button>
            `).join('');

          // Load initial year data (most recent year)
          loadFinancialData(years[0]);
        } catch (error) {
          console.error('Error initializing year selector:', error);
        }
      };

      // Initialize the page
      document.addEventListener('DOMContentLoaded', initializeYearSelector);
    </script>
  </body>
</html> 